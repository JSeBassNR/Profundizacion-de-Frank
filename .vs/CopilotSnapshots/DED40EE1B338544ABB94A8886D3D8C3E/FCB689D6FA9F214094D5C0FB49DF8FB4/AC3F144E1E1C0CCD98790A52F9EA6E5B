package com.example.Sheep.infraestructure.client;

import com.example.Sheep.domain.model.gateway.GanaderoClientGateway;
import lombok.RequiredArgsConstructor;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Component;
import org.springframework.web.client.RestClient;
import org.springframework.web.client.RestClientResponseException;

/**
 * Implementación HTTP del puerto {@link GanaderoClientGateway} usando RestClient.
 * Realiza una consulta simple al endpoint de detalle de ganadero para verificar
 * la existencia de un id.
 */
@Component
@RequiredArgsConstructor
public class GanaderoClient implements GanaderoClientGateway {
 private final RestClient restClient;

 @Value("${ganadero.service.base-url:http://localhost:9192}")
 private String baseUrl;

 @Override
 public boolean existeGanadero(Long id) {
 if (id == null) return false;
 try {
 var response = restClient.get()
 .uri(baseUrl + "/api/ganadero/" + id)
 .retrieve()
 .toBodilessEntity();
 return response.getStatusCode().is2xxSuccessful();
 } catch (RestClientResponseException ex) {
 if (ex.getStatusCode() == HttpStatus.NOT_FOUND) return false;
 // Rethrow para que la capa superior decida (p.e. fallback,502, etc.)
 throw ex;
 }
 }
}
