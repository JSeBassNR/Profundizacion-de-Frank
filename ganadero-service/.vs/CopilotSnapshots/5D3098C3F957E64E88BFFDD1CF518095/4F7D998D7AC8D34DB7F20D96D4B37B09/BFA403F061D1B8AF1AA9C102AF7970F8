package com.example.sheep.domain.usecase;

import com.example.sheep.domain.exception.DomainValidationException;
import com.example.sheep.domain.exception.DuplicateEmailException;
import com.example.sheep.domain.model.Ganadero;
import com.example.sheep.domain.model.gateway.GanaderoGateway;
import lombok.RequiredArgsConstructor;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.stereotype.Service;

@RequiredArgsConstructor
@Service
public class GanaderoUseCase {
 private final GanaderoGateway gateway;

 public Ganadero guardar(Ganadero g){
 g.validate();
 // Regla: no permitir correos repetidos
 var existente = gateway.buscarPorEmail(g.getEmail());
 if (existente != null) {
 throw new DuplicateEmailException("Ya existe un ganadero con el correo: " + g.getEmail());
 }
 return gateway.guardar(g);
 }
 public Ganadero buscarPorId(Long id){
 return gateway.buscarPorId(id);
 }
 public Ganadero actualizar(Ganadero g){
 if(g.getId()==null){
 throw new DomainValidationException("ID requerido");
 }
 g.validate();
 // Si cambia el email, validar duplicado contra otro registro
 var existente = gateway.buscarPorEmail(g.getEmail());
 if (existente != null && !existente.getId().equals(g.getId())) {
 throw new DuplicateEmailException("Ya existe un ganadero con el correo: " + g.getEmail());
 }
 return gateway.actualizar(g);
 }
 public void eliminar(Long id){
 gateway.eliminar(id);
 }
 public Ganadero buscarPorEmail(String email){
 return gateway.buscarPorEmail(email);
 }
 public Page<Ganadero> obtenerPaginado(Pageable pageable){
 return gateway.obtenerPaginado(pageable);
 }
}
